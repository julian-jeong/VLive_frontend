(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[982],{6065:function(n,e,t){"use strict";t.r(e),t.d(e,{default:function(){return On}});var r=t(168),a=t(7294),i=t(4524),o=t(1163),c=t(3942),s=t(3172),u=t(5785),l=t(5861),d=t(7757),p=t.n(d),h=t(2503),f=t(3486);function x(){return(x=(0,l.Z)(p().mark((function n(e){var t,r,a,i,o;return p().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,fetch("".concat(f.b.URL,"/chat/").concat(e),{method:"GET",headers:{"Content-Type":"application/json"}});case 3:return t=n.sent,n.next=6,t.json();case 6:if(r=n.sent,a=r.result,i=r.data,o=r.message,"error"!==a){n.next=12;break}throw new Error(o);case 12:return n.abrupt("return",i);case 15:return n.prev=15,n.t0=n.catch(0),n.abrupt("return",n.t0);case 18:case"end":return n.stop()}}),n,null,[[0,15]])})))).apply(this,arguments)}function g(n){var e=(0,h.ZP)(n?"/chat/channelId":null,(function(){return function(n){return x.apply(this,arguments)}(n)}));return{chatList:e.data,mutate:e.mutate}}var m,v,E=t(6388),b=t(7144),N=t(5893);function y(){var n=(0,o.useRouter)().query.channelId,e=g(n),t=e.chatList,r=e.error,i=e.mutate,c=(0,a.useRef)();return r?(0,N.jsx)(s.Z,{message:r.message}):((0,a.useEffect)((function(){null!=t&&(c.current.scrollTop=c.current.scrollHeight)}),[t]),(0,E.sV)(b.EVENTS.LISTEN_NEW_CHAT,(function(n){i([].concat((0,u.Z)(t),[n]))})),null==n||null==t?null:(0,N.jsx)(S,{ref:c,children:(0,N.jsx)("ul",{className:"chat-list",children:t.map((function(n){return(0,N.jsxs)(w,{children:[(0,N.jsx)("span",{className:"author",children:n.author}),(0,N.jsx)("span",{children:n.chat})]},n._id)}))})}))}var j,S=i.Z.div(m||(m=(0,r.default)(["\n  height: 85%;\n  padding-top: 5px;\n  box-sizing: border-box;\n  border-inline: 2px solid ",";\n  background-color: ",";\n  overflow-y: auto;\n  color: white;\n\n  .chat-list {\n    padding: 10px 0 0 10px;\n    list-style: none;\n    text-align: left;\n  }\n"])),(function(n){return n.theme.darkNavy}),(function(n){return n.theme.darkNavy})),w=i.Z.li(v||(v=(0,r.default)(["\n  margin-top: 5px;\n\n  .author {\n    margin-right: 10px;\n    padding: 0 5px;\n    border-radius: 5px;\n    font-size: 14px;\n    line-height: 14px;\n    background-color: #d6d6d6;\n    color: ",";\n  }\n"])),(function(n){return n.theme.darkNavy}));function T(){var n=(0,o.useRouter)().query.channelId,e=(0,a.useState)({author:"",chat:""}),t=e[0],r=e[1],i=(0,a.useState)(""),c=i[0],u=i[1];function d(){return(d=(0,l.Z)(p().mark((function e(a){var i,o,c,u;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.preventDefault(),e.prev=1,e.next=4,fetch("".concat(f.b.URL,"/chat"),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({channelId:n,input:t})});case 4:return i=e.sent,e.next=7,i.json();case 7:if(o=e.sent,c=o.result,u=o.message,"error"!==c){e.next=12;break}throw new Error(u);case 12:e.next=17;break;case 14:return e.prev=14,e.t0=e.catch(1),e.abrupt("return",(0,N.jsx)(s.Z,{message:e.t0.message}));case 17:(0,E.getSocketClient)().emit(b.EVENTS.NEW_CHAT,{channelId:n,input:t}),r({author:"",chat:""});case 19:case"end":return e.stop()}}),e,null,[[1,14]])})))).apply(this,arguments)}return(0,a.useEffect)((function(){var n=JSON.parse(sessionStorage.getItem("user")).name;u(n)}),[]),(0,N.jsxs)(k,{onSubmit:function(n){return d.apply(this,arguments)},children:[(0,N.jsx)("input",{type:"text",value:t.chat,autoComplete:"off",onChange:function(n){var e=n.target.value.trim();""!==e&&r({author:c.replace(" ",""),chat:e})}}),(0,N.jsx)("button",{type:"submit",children:"Enter"})]})}var _,I,k=i.Z.form(j||(j=(0,r.default)(["\n  display: flex;\n  align-items: center;\n  width: 100%;\n\n  input {\n    width: 80%;\n    height: 40px;\n    padding: 0px 20px;\n    border: none;\n    font-size: 16px;\n    background-color: whitesmoke;\n\n    &:focus {\n      outline: none;\n    }\n  }\n\n  button {\n    display: inline-block;\n    width: 15%;\n    height: 30px;\n    outline: none;\n    border: none;\n    cursor: pointer;\n    border-radius: 15px;\n    background-color: lightGray;\n  }\n"]))),R=t(5675),Z=t(1657);function L(n){var e=n.onShowResult,t=n.onShowChat,r=(0,o.useRouter)().query.channelId,i=(0,Z.Z)(r),c=i.players,u=i.error,d=(0,a.useState)(""),h=d[0],x=d[1];if(u)return(0,N.jsx)(s.Z,{message:u.message});if(null==r||null==c)return null;function g(n){return m.apply(this,arguments)}function m(){return(m=(0,l.Z)(p().mark((function n(e){var a,i,o,c,u;return p().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a=e.currentTarget,x(a.id),n.prev=2,n.next=5,fetch("".concat(f.b.URL,"/channel/").concat(r),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({state:"voting",playerId:a.id})});case 5:return i=n.sent,n.next=8,i.json();case 8:if(o=n.sent,c=o.result,u=o.message,"error"!==c){n.next=13;break}throw new Error(u);case 13:t(),n.next=19;break;case 16:return n.prev=16,n.t0=n.catch(2),n.abrupt("return",(0,N.jsx)(s.Z,{message:n.t0.message}));case 19:case"end":return n.stop()}}),n,null,[[2,16]])})))).apply(this,arguments)}return(0,a.useEffect)((function(){var n=setTimeout((function(){e()}),1e4);return function(){return clearTimeout(n)}}),[]),(0,N.jsxs)(O,{children:[(0,N.jsx)("h1",{className:"vote-title",children:"\ucd5c\uace0\uc758 \uce90\ub9ad\ud130\uc5d0\uac8c \ud22c\ud45c\ud574\uc8fc\uc138\uc694"}),(0,N.jsx)("span",{className:"vote-subtitle",children:"\ud22c\ud45c\ub294 \ud55c \ubc88\ub9cc \ucc38\uc5ec \uac00\ub2a5\ud569\ub2c8\ub2e4."}),(0,N.jsx)("div",{className:"characters",children:c.map((function(n){var e,t,r;return(0,N.jsxs)(U,{className:"character",id:n._id,onClick:g,children:[(0,N.jsx)("div",{className:"img ".concat(h===n._id&&"border"),children:(0,N.jsx)(R.default,{src:null===(e=n.characterId)||void 0===e?void 0:e.imgUrl,alt:"character-image",width:110,height:150})}),(0,N.jsx)("span",{className:"img ".concat(h===n._id&&"color"),children:null===(t=n.characterId)||void 0===t?void 0:t.name}),(0,N.jsx)("span",{className:"user-name",children:null===(r=n.userId)||void 0===r?void 0:r.name})]},n._id)}))})]})}var C,A,O=i.Z.div(_||(_=(0,r.default)(["\n  color: white;\n\n  .vote-title {\n    margin: 15px 0 0 0;\n    font-size: 20px;\n  }\n\n  .vote-subtitle {\n    padding: 20px 0 0 0;\n    font-weight: 200px;\n    font-size: 16px;\n    color: #898bf3;\n  }\n\n  .characters {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    margin-top: 10px;\n  }\n"]))),U=i.Z.div(I||(I=(0,r.default)(["\n  margin: 0 20px;\n  cursor: pointer;\n  transition: all 100ms ease-out;\n\n  &:hover {\n    transform: scale(1.02);\n  }\n\n  .img {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    width: 113px;\n    height: 153px;\n  }\n\n  .character-name {\n    display: block;\n    padding: 4px 0;\n    font-size: 18px;\n  }\n\n  .user-name {\n    background-color: #898bf3;\n    padding: 0px 4px;\n    border-radius: 5px;\n    font-weight: 700;\n    font-size: 13px;\n    color: black;\n  }\n\n  .color {\n    color: ",";\n  }\n\n  .border {\n    border: ",";\n  }\n"])),(function(n){return n.theme.pink}),(function(n){return"3px solid"+n.theme.pink}));function P(n,e){var t="undefined"!==typeof Symbol&&n[Symbol.iterator]||n["@@iterator"];if(!t){if(Array.isArray(n)||(t=function(n,e){if(!n)return;if("string"===typeof n)return V(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);"Object"===t&&n.constructor&&(t=n.constructor.name);if("Map"===t||"Set"===t)return Array.from(n);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return V(n,e)}(n))||e&&n&&"number"===typeof n.length){t&&(n=t);var r=0,a=function(){};return{s:a,n:function(){return r>=n.length?{done:!0}:{done:!1,value:n[r++]}},e:function(n){throw n},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,c=!1;return{s:function(){t=t.call(n)},n:function(){var n=t.next();return o=n.done,n},e:function(n){c=!0,i=n},f:function(){try{o||null==t.return||t.return()}finally{if(c)throw i}}}}function V(n,e){(null==e||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}function D(){var n=(0,o.useRouter)().query.channelId,e=(0,o.useRouter)(),t=(0,Z.Z)(n),r=t.players,i=t.error,c=(0,a.useState)([]),d=c[0],h=c[1];if(i)return(0,N.jsx)(s.Z,{message:i.message});function x(){return(x=(0,l.Z)(p().mark((function e(){var t,r,a,i;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("".concat(f.b.URL,"/channel/").concat(n),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({state:"end",channelId:n})});case 3:return t=e.sent,e.next=6,t.json();case 6:if(r=e.sent,a=r.result,i=r.message,"error"!==a){e.next=11;break}throw new Error(i);case 11:e.next=16;break;case 13:return e.prev=13,e.t0=e.catch(0),e.abrupt("return",(0,N.jsx)(s.Z,{message:e.t0.message}));case 16:case"end":return e.stop()}}),e,null,[[0,13]])})))).apply(this,arguments)}return(0,a.useEffect)((function(){var t=setTimeout((function(){e.push("/main")}),15e3);return function(){clearTimeout(t),function(){x.apply(this,arguments)}(),(0,E.getSocketClient)().emit(b.EVENTS.END_CHANNEL,n),(0,E.getSocketClient)().off(b.EVENTS.LISTEN_ENTER_CHANNEL),(0,E.getSocketClient)().off(b.EVENTS.LISTEN_NEW_CHAT)}}),[]),(0,a.useEffect)((function(){var n=r.map((function(n){return n.voteCount}));r.forEach((function(e){e.voteCount===Math.max.apply(Math,(0,u.Z)(n))&&h((function(n){return n.concat(e._id)}))}))}),[]),(0,N.jsxs)(J,{children:[(0,N.jsx)("h1",{className:"result-title",children:"\ud22c\ud45c \uacb0\uacfc"}),(0,N.jsxs)("span",{className:"result-subtitle",children:[function(){var n,e=[],t=P(r);try{for(t.s();!(n=t.n()).done;){var a=n.value;d.includes(a._id)&&e.push(", ".concat(a.userId.name,"\ub2d8"))}}catch(i){t.e(i)}finally{t.f()}return e.join(" ").slice(2)}()," \ucd95\ud558\ud569\ub2c8\ub2e4!"]}),(0,N.jsx)("div",{className:"characters",children:d&&r.map((function(n){var e,t,r,a,i=(a=n._id,null===d||void 0===d?void 0:d.includes(a));return(0,N.jsxs)(Y,{id:n._id,iswinner:i,children:[(0,N.jsx)("div",{className:"img",children:(0,N.jsx)(R.default,{src:null===(e=n.characterId)||void 0===e?void 0:e.imgUrl,alt:"character-image",width:150,height:200})}),(0,N.jsx)("span",{className:"character-name",children:null===(t=n.characterId)||void 0===t?void 0:t.name}),(0,N.jsx)("span",{className:"user-name",children:null===(r=n.userId)||void 0===r?void 0:r.name}),(0,N.jsxs)("span",{className:"voting-result",children:[n.voteCount," \ud45c"]})]},n._id)}))})]})}var z,H,G,J=i.Z.div(C||(C=(0,r.default)(["\n  height: 100%;\n  background-color: black;\n\n  .result-title {\n    margin: 0;\n    padding: 30px 0 10px 0;\n    font-size: 20px;\n    color: white;\n  }\n\n  .result-subtitle {\n    padding: 30px 0 30px 0;\n    font-weight: 200px;\n    font-size: 22px;\n    color: ",";\n  }\n\n  .characters {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    margin-top: 10px;\n  }\n"])),(function(n){return n.theme.pink||"white"})),Y=i.Z.div(A||(A=(0,r.default)(["\n  margin: 0 20px;\n  cursor: pointer;\n  transition: all 100ms ease-out;\n\n  &:hover {\n    transform: scale(1.02);\n  }\n\n  .img {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    width: 153px;\n    height: 203px;\n    border: ",";\n  }\n\n  .character-name {\n    display: block;\n    padding: 10px 0;\n    font-size: 18px;\n    color: ",";\n  }\n\n  .user-name {\n    background-color: #898bf3;\n    padding: 1px 4px;\n    border-radius: 5px;\n    font-weight: 700;\n    font-size: 18px;\n    color: ",";\n  }\n\n  .voting-result {\n    display: block;\n    padding: 10px 0;\n    font-size: 24px;\n    color: ",";\n  }\n\n  .clicked {\n    color: ",";\n  }\n"])),(function(n){var e=n.iswinner,t=n.theme;return e?"3px solid"+t.pink:"none"}),(function(n){var e=n.iswinner,t=n.theme;return e?t.pink:"white"}),(function(n){return n.iswinner?"white":"black"}),(function(n){var e=n.iswinner,t=n.theme;return e?t.pink:"white"}),(function(n){return n.theme.pink})),M=(t(835),t(8853)),q=t.n(M);function X(n){var e=n.peer,t=(0,a.useRef)();return(0,a.useEffect)((function(){e&&e.on("stream",(function(n){t.current.srcObject=n}))}),[e]),(0,N.jsx)("video",{ref:t,autoPlay:!0,width:"150px",height:"150px"})}function W(n){var e=n.isVideoEnd,t=(0,o.useRouter)().query.channelId,r=(0,a.useState)([]),i=r[0],c=r[1],s=(0,a.useRef)([]),d=(0,a.useRef)(),h=(0,a.useRef)();function f(n,e,t){var r=new(q())({initiator:!0,trickle:!1,stream:t});return r.on("signal",function(){var t=(0,l.Z)(p().mark((function t(r){return p().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:(0,E.getSocketClient)().emit(b.EVENTS.SENDING_SIGNAL,{userToSignal:n,callerId:e,signal:r});case 1:case"end":return t.stop()}}),t)})));return function(n){return t.apply(this,arguments)}}()),r}function x(n,e,t){var r=new(q())({initiator:!1,trickle:!1,stream:t});return r.on("signal",(function(n){(0,E.getSocketClient)().emit(b.EVENTS.RETURNING_SIGNAL,{signal:n,callerId:e})})),r.signal(n),r}return(0,E.sV)(b.EVENTS.LISTEN_READY_TO_START,(function(n){t===n&&h.current.play()})),(0,a.useEffect)((0,l.Z)(p().mark((function n(){var e,r,a,i,o,l,h;return p().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,navigator.mediaDevices.getUserMedia({video:!0,audio:!0});case 2:return e=n.sent,d.current.srcObject=e,d.current.play(),r=JSON.parse(sessionStorage.getItem("user")),a=r._id,i=r.name,o=r.email,l=r.photoUrl,h={_id:a,name:i,email:o,photoUrl:l,channelId:t},(0,E.getSocketClient)().emit(b.EVENTS.ENTER_CHANNEL,h),(0,E.getSocketClient)().once(b.EVENTS.ALL_USER,(function(n){var t=[];n.forEach((function(n){var r=f(n,(0,E.cH)(),e);s.current.push({peerID:n,peer:r}),t.push(r)})),c(t)})),(0,E.getSocketClient)().on(b.EVENTS.USER_JOINED,(function(n){var t=n.signal,r=n.callerId,a=x(t,r,e);s.current.push({peerID:r,peer:a}),c((function(n){return[].concat((0,u.Z)(n),[a])}))})),(0,E.getSocketClient)().on(b.EVENTS.RECEIVING_RETURNED_SIGNAL,(function(n){var e=n.id,t=n.signal;s.current.find((function(n){return n.peerID===e})).peer.signal(t)})),n.abrupt("return",(function(){(0,E.getSocketClient)().removeAllListeners(b.EVENTS.ALL_USER),(0,E.getSocketClient)().removeAllListeners(b.EVENTS.USER_JOINED),(0,E.getSocketClient)().removeAllListeners(b.EVENTS.RECEIVING_RETURNED_SIGNAL),e&&(e.getVideoTracks().forEach((function(n){n.stop(),e.removeTrack(n)})),delete s.current,c((function(n){return n.forEach((function(n){n.destroy()})),[]})))}));case 12:case"end":return n.stop()}}),n)}))),[]),(0,N.jsxs)(nn,{children:[(0,N.jsx)(K,{ref:h,playsInline:!0,src:"https://awwdwd.s3.ap-northeast-2.amazonaws.com/sampleVideo.mp4",onEnded:function(){e()},muted:!0}),(0,N.jsxs)(Q,{children:[(0,N.jsx)("video",{playsInline:!0,autoPlay:!0,ref:d,width:"150px",height:"150px",muted:!0}),i.map((function(n,e){return(0,N.jsx)(X,{peer:n},e)}))]})]})}var F,B,$,K=i.Z.video(z||(z=(0,r.default)(["\n  width: 810px;\n  height: 455px;\n  margin-top: -10px;\n"]))),Q=i.Z.div(H||(H=(0,r.default)(["\n  width: 150px;\n  height: 450px;\n  float: right;\n"]))),nn=i.Z.div(G||(G=(0,r.default)(["\n  width: 100%;\n  height: 55%;\n  background-image: url('/images/background.jpg');\n"])));function en(){var n=(0,o.useRouter)().query.channelId,e=(0,c.Z)(n),t=e.channel,r=e.error,i=(0,a.useState)(!1),u=i[0],l=i[1],d=(0,a.useState)(!1),p=d[0],h=d[1];if(null==n||null==t)return null;if(r)return(0,N.jsx)(s.Z,{message:r.message});if(null==n||null==t)return null;if(r)return(0,N.jsx)(s.Z,{message:r.message});var f=t.name,x=t.episode;return(0,N.jsxs)(rn,{children:[(0,N.jsxs)("header",{children:[(0,N.jsx)("h2",{className:"channel-name",children:f}),(0,N.jsx)("h3",{className:"episode-title",children:null===x||void 0===x?void 0:x.title})]}),(0,N.jsx)(an,{children:u?(0,N.jsx)(D,{}):(0,N.jsx)(W,{isVideoEnd:function(){return h(!0)}})}),(0,N.jsx)(on,{children:p?(0,N.jsx)(L,{onShowResult:function(){return l(!0)},onShowChat:function(){return h(!1)}}):(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(y,{}),(0,N.jsx)(T,{})]})})]})}var tn,rn=i.Z.div(F||(F=(0,r.default)(["\n  width: 70%;\n  height: auto;\n  padding: 0 50px;\n  box-sizing: border-box;\n  background-color: rgba(0, 0, 0, 0.6);\n\n  header {\n    height: 10%;\n    padding-left: 20px;\n    text-align: left;\n    background-color: rgba(0, 0, 0, 0.6);\n    color: #ffffff;\n    border: 1px solid black;\n  }\n\n  .channel-name {\n    margin: 0px;\n    padding-top: 15px;\n    padding-bottom: 10px;\n    font-size: 1.2em;\n    font-weight: 200;\n  }\n\n  .episode-title {\n    margin: 0px;\n    padding-bottom: 10px;\n    font-size: 1.5em;\n    font-weight: 500;\n  }\n"]))),an=i.Z.div(B||(B=(0,r.default)(["\n  width: 100%;\n  height: 50%;\n  background-image: url('/images/background.jpg');\n"]))),on=i.Z.div($||($=(0,r.default)(["\n  height: 40%;\n"]))),cn=t(4942);function sn(n){var e=n.player,t=e.userId,r=e.characterId;return(0,N.jsxs)("div",{className:"player-profile",children:[(0,N.jsx)("div",{className:"player-name",children:null===t||void 0===t?void 0:t.name}),(0,N.jsx)("div",{className:"character-name",children:null===r||void 0===r?void 0:r.name})]},null===t||void 0===t?void 0:t._id)}function un(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),t.push.apply(t,r)}return t}function ln(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?un(Object(t),!0).forEach((function(e){(0,cn.Z)(n,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):un(Object(t)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))}))}return n}function dn(){var n=(0,o.useRouter)().query.channelId,e=(0,Z.Z)(n),t=e.players,r=e.error,a=e.mutate;return(0,E.sV)(b.EVENTS.LISTEN_ENTER_CHANNEL,(function(n){var e={userId:n._id,voteCount:0};a((function(n){return ln(ln({},n),{},{players:[].concat((0,u.Z)(n.players),[e])})}))})),(0,E.sV)(b.EVENTS.LISTEN_EXIT_CHANNEL,(function(n){var e=t.filter((function(e){return e.userId._id!==n.userId}));a((function(n){return ln(ln({},n),{},{newPlayers:e})}))})),(0,E.sV)(b.EVENTS.LISTEN_PLAYER_READY,(function(n){var e=t.map((function(e){return e.userId._id===n._id&&(e.characterId=n.userRole.characterId),e}));a((function(n){return ln(ln({},n),{},{readyPlayers:e})}))})),null==n||null==t?null:r?(0,N.jsx)(s.Z,{message:r.message}):(0,N.jsx)(gn,{children:t.map((function(n){return(0,N.jsx)(sn,{player:n},n._id)}))})}var pn,hn,fn,xn,gn=i.Z.div(tn||(tn=(0,r.default)(["\n  width: 100%;\n  height: 55%;\n  color: white;\n\n  .player-profile {\n    width: 100%;\n    height: 50px;\n  }\n"]))),mn=t(4651),vn=t(694),En=t(9254);function bn(n){var e=n.isModalOpen,t=n.closeModal,r=(0,a.useState)([]),i=r[0],o=r[1],u=(0,a.useState)({characterId:""}),d=u[0],h=u[1],x=(0,mn.useRouter)().query.channelId,g=(0,c.Z)(x),m=g.channel,v=g.error;if(null==x||null==m)return null;if(v)return(0,N.jsx)(s.Z,{message:v.message});function y(n){var e=n.currentTarget.id;h((0,cn.Z)({},"characterId",e))}function j(){return(j=(0,l.Z)(p().mark((function n(e){var r,a,o,c,u,l;return p().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return e.preventDefault(),r=JSON.parse(sessionStorage.getItem("user")),a=r._id,n.prev=2,n.next=5,fetch("".concat(f.b.URL,"/channel/").concat(x),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({state:"character",userId:a,characterId:d.characterId})});case 5:return o=n.sent,n.next=8,o.json();case 8:if(c=n.sent,u=c.result,l=c.message,"error"!==u){n.next=13;break}throw new Error(l);case 13:(0,E.getSocketClient)().emit(b.EVENTS.PLAYER_READY,{channelId:x,_id:a,userRole:d,episodeInfo:i}),t(),n.next=20;break;case 17:return n.prev=17,n.t0=n.catch(2),n.abrupt("return",(0,N.jsx)(s.Z,{message:n.t0.message}));case 20:case"end":return n.stop()}}),n,null,[[2,17]])})))).apply(this,arguments)}(0,a.useEffect)((function(){function n(){return(n=(0,l.Z)(p().mark((function n(){var e,t,r,a,i;return p().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,fetch("".concat(f.b.URL,"/episode/").concat(m.episode._id),{method:"GET",headers:{"Content-Type":"application/json"}});case 3:return e=n.sent,n.next=6,e.json();case 6:if(t=n.sent,r=t.result,a=t.data,i=t.message,"error"!==r){n.next=12;break}throw new Error(i);case 12:o(a),n.next=18;break;case 15:n.prev=15,n.t0=n.catch(0),console.error(n.t0.message);case 18:case"end":return n.stop()}}),n,null,[[0,15]])})))).apply(this,arguments)}!function(){n.apply(this,arguments)}()}),[e]);var S=i.title,w=i.characters;return(0,N.jsxs)(yn,{children:[(0,N.jsxs)("div",{className:"header",children:[(0,N.jsx)("span",{className:"title",children:"\uc5ed\ud560\uace0\ub974\uae30"}),(0,N.jsx)("button",{type:"button",onClick:t,children:"\ub098\uac00\uae30"})]}),(0,N.jsxs)(jn,{onSubmit:function(n){return j.apply(this,arguments)},children:[(0,N.jsx)("span",{className:"character-select",children:"\uc5f0\uae30\ud560 \ubc30\uc5ed\uc744 \uc120\ud0dd\ud558\uc138\uc694"}),(0,N.jsx)("div",{className:"episode-title",children:S}),(0,N.jsx)(Sn,{children:(0,N.jsx)("ul",{className:"character-list",children:null===w||void 0===w?void 0:w.map((function(n){return(0,N.jsxs)(wn,{id:n._id,onClick:y,children:[(0,N.jsx)("span",{className:"character-name",children:n.name}),(0,N.jsx)("div",{className:d.characterId===n._id&&"character-image",children:(0,N.jsx)(R.default,{src:null===n||void 0===n?void 0:n.imgUrl,alt:"character-imgUrl",width:90,height:100,layout:"responsive"})})]},n._id)}))})}),(0,N.jsx)("div",{className:"button",children:(0,N.jsx)(vn.Z,{type:"submit",children:"\ubc30\uc5ed \uace0\ub974\uae30"})})]})]})}var Nn,yn=i.Z.div(pn||(pn=(0,r.default)(["\n  width: 100%;\n  height: 100%;\n  border: 1px solid white;\n  background-color: ",";\n  color: white;\n\n  .header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    height: 10%;\n    margin-top: 25px;\n    padding: 0 50px;\n\n    .title {\n      font-size: 24px;\n      line-height: 24px;\n    }\n  }\n"])),(function(n){return n.theme.navy})),jn=i.Z.form(hn||(hn=(0,r.default)(["\n  display: flex;\n  flex-direction: column;\n  align-items: flex-start;\n  height: 90%;\n  padding: 30px 50px;\n  box-sizing: border-box;\n  text-align: left;\n\n  .channel-name {\n    display: block;\n  }\n\n  .button {\n    margin: 25px auto 0 auto;\n  }\n"]))),Sn=i.Z.div(fn||(fn=(0,r.default)(["\n  margin-top: 10px;\n\n  .character-select {\n    font-size: 16px;\n  }\n\n  .character-list {\n    display: grid;\n    grid-template-columns: repeat(3, minmax(100px, 170px));\n    padding: 0;\n  }\n\n  .character-image {\n    border: 2px solid ",";\n  }\n\n  .image {\n    margin-top: 10px;\n  }\n"])),En.Z.pink),wn=i.Z.li(xn||(xn=(0,r.default)(["\n  display: flex;\n  flex-direction: column;\n  height: 150px;\n  margin: 0 15px 20px 0;\n  font-size: 12px;\n  list-style: none;\n  cursor: pointer;\n\n  .character-name {\n    margin-bottom: 5px;\n  }\n"]))),Tn=t(4461);function _n(){var n=(0,a.useState)(!1),e=n[0],t=n[1],r=(0,a.useState)(null),i=r[0],u=r[1],d=(0,a.useState)(!1),h=d[0],x=d[1],g=(0,o.useRouter)().query.channelId,m=(0,o.useRouter)();(0,a.useEffect)((function(){var n=JSON.parse(sessionStorage.getItem("user"))._id;u(n)}),[]);var v=(0,c.Z)(g).channel;function y(){t(!1)}function j(){return(j=(0,l.Z)(p().mark((function n(){var e,t,r;return p().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,fetch("".concat(f.b.URL,"/channel/").concat(g),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({state:"exit",userId:i})});case 3:if(e=n.sent,t=e.result,r=e.message,"error"!==t){n.next=7;break}throw new Error(r);case 7:(0,E.getSocketClient)().emit(b.EVENTS.EXIT_CHANNEL,{channelId:g,userId:i}),m.push("/main"),n.next=14;break;case 11:return n.prev=11,n.t0=n.catch(0),n.abrupt("return",(0,N.jsx)(s.Z,{message:n.t0.message}));case 14:case"end":return n.stop()}}),n,null,[[0,11]])})))).apply(this,arguments)}function S(){return(S=(0,l.Z)(p().mark((function n(){var e,t,r,a;return p().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,fetch("".concat(f.b.URL,"/channel/").concat(g),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({state:"start",channelId:g})});case 3:return e=n.sent,n.next=6,e.json();case 6:if(t=n.sent,r=t.result,a=t.message,"error"!==r){n.next=11;break}throw new Error(a);case 11:(0,E.getSocketClient)().emit(b.EVENTS.READY_TO_START,g),n.next=17;break;case 14:return n.prev=14,n.t0=n.catch(0),n.abrupt("return",(0,N.jsx)(s.Z,{message:n.t0.message}));case 17:case"end":return n.stop()}}),n,null,[[0,14]])})))).apply(this,arguments)}return(0,E.getSocketClient)().on(b.EVENTS.LISTEN_GAME_START,(function(n){n&&i===(null===v||void 0===v?void 0:v.host._id)&&x(!0)})),(0,N.jsxs)(kn,{children:[(0,N.jsxs)("div",{className:"button-wrapper",children:[h?(0,N.jsx)(vn.Z,{onClick:function(){return S.apply(this,arguments)},children:"Start"}):(0,N.jsx)(vn.Z,{onClick:function(){t(!0)},children:"Ready"}),(0,N.jsx)(vn.Z,{onClick:function(){return j.apply(this,arguments)},children:"\ub098\uac00\uae30"})]}),e&&(0,N.jsx)(Tn.Z,{closeModal:y,children:(0,N.jsx)(bn,{closeModal:y,isModalOpen:e})})]})}var In,kn=i.Z.div(Nn||(Nn=(0,r.default)(["\n  padding: 10px;\n\n  .ready {\n    color: navy;\n  }\n"])));function Rn(){return(0,N.jsxs)(Ln,{children:[(0,N.jsx)(dn,{}),(0,N.jsx)(_n,{})]})}var Zn,Ln=i.Z.div(In||(In=(0,r.default)(["\n  width: 30%;\n  height: auto;\n  background: #1d2e3c;\n"])));function Cn(){var n=(0,o.useRouter)().query.channelId,e=(0,c.Z)(n),t=e.channel,r=e.error;return r?(0,N.jsx)(s.Z,{message:r.message}):null==n||null==t?null:(0,N.jsxs)(An,{children:[(0,N.jsx)(en,{}),(0,N.jsx)(Rn,{})]})}var An=i.Z.div(Zn||(Zn=(0,r.default)(["\n  display: flex;\n  position: relative;\n  text-align: center;\n  background-image: linear-gradient(\n      rgba(5, 5, 5, 0.746),\n      rgba(58, 57, 57, 0.842),\n      rgba(54, 54, 54, 0.5),\n      rgba(58, 57, 57, 0.842),\n      rgba(5, 5, 5, 0.746)\n    ),\n    url('/images/background.jpg');\n  height: 100vh;\n"])));function On(){return(0,N.jsx)(Cn,{})}},694:function(n,e,t){"use strict";t.d(e,{Z:function(){return p}});var r,a=t(168),i=t(4942),o=t(4925),c=(t(7294),t(4524)),s=t(5893),u=["children"];function l(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),t.push.apply(t,r)}return t}function d(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?l(Object(t),!0).forEach((function(e){(0,i.Z)(n,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))}))}return n}function p(n){var e=n.children,t=(0,o.Z)(n,u);return(0,s.jsx)(h,d(d({},t),{},{children:e}))}p.defaultProps={type:"button"};var h=c.Z.button(r||(r=(0,a.default)(["\n  all: unset;\n  width: ",";\n  height: ",";\n  padding: 15px 20px;\n  font-size: ",";\n  line-height: ",";\n  font-weight: ",";\n  text-align: center;\n  cursor: pointer;\n  border-radius: ",";\n  background-color: ",";\n  transition-property: scale, translateY;\n  transition: scale 300ms ease-in;\n  color: ",";\n\n  &:hover {\n    transform: scale(0.97);\n    opacity: 80%;\n    background-color: ",";\n    color: ",";\n  }\n"])),(function(n){return n.width||"130px"}),(function(n){return n.height||"20px"}),(function(n){return n.fontSize||"14px"}),(function(n){return n.fontSize||"14px"}),(function(n){return n.fontWeight||"500"}),(function(n){return n.borderRadius||"20px"}),(function(n){var e=n.bgColor,t=n.theme;return e||t.gray}),(function(n){var e=n.color,t=n.theme;return e||t.black}),(function(n){var e=n.hoverBgColor,t=n.theme;return e||t.gray}),(function(n){var e=n.hoverColor,t=n.theme;return e||t.darkNavy}))},3172:function(n,e,t){"use strict";t.d(e,{Z:function(){return o}});t(7294);var r=t(1664),a=t(694),i=t(5893);function o(n){var e=n.message;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("p",{children:e}),(0,i.jsx)(r.default,{href:"/",passHref:!0,children:(0,i.jsx)("a",{children:(0,i.jsx)(a.Z,{color:"red",children:"\ud648\uc73c\ub85c \ub3cc\uc544\uac00\uae30"})})})]})}},4461:function(n,e,t){"use strict";t.d(e,{Z:function(){return u}});var r,a,i,o=t(168),c=t(4524),s=t(5893);function u(n){var e=n.children,t=n.closeModal;return(0,s.jsxs)(l,{children:[(0,s.jsx)(d,{onClick:t}),(0,s.jsx)(p,{children:e})]})}var l=c.Z.div(r||(r=(0,o.default)(["\n  width: 100%;\n  height: 100%;\n"]))),d=c.Z.div(a||(a=(0,o.default)(["\n  z-index: 99;\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n  background: rgba(0, 0, 0, 0.8);\n"]))),p=c.Z.div(i||(i=(0,o.default)(["\n  z-index: 999;\n  position: fixed;\n  top: 50%;\n  left: 50%;\n  width: 600px;\n  height: 450px;\n  text-align: center;\n  background-color: white;\n  transform: translate(-50%, -50%);\n  box-shadow: 0px 1px 5px 3px rgba(0, 0, 0, 0.1);\n"])))},3486:function(n){n.exports.b={URL:"http://localhost:8000"}},7144:function(n){n.exports.EVENTS={ENTER_CHANNEL:"enter channel",LISTEN_ENTER_CHANNEL:"listen enter channel",LISTEN_ENTER_CHANNEL_LIST:"listen enter channel list",CREATE_CHANNEL:"create channel",LISTEN_CREATE_CHANNEL:"listen create channel",EXIT_CHANNEL:"exit channel",LISTEN_EXIT_CHANNEL:"listen exit channel",LISTEN_EXIT_CHANNEL_LIST:"listen exit channel list",END_CHANNEL:"end channel",LISTEN_END_CHANNEL:"listen end channel",NEW_CHAT:"new chat",LISTEN_NEW_CHAT:"listen new chat",PLAYER_READY:"player ready",LISTEN_PLAYER_READY:"listen player ready",SEND_SIGNAL:"send signal",RETURN_SIGNAL:"return signal",LISTEN_SEND_SIGNAL:"listen send signal",LISTEN_RETURN_SIGNAL:"listen return signal",ALL_USER:"all user",SENDING_SIGNAL:"sending signal",RETURNING_SIGNAL:"returning signal",USER_JOINED:"user joined",RECEIVING_RETURNED_SIGNAL:"receiving returned signal",LISTEN_GAME_START:"listen game start",READY_TO_START:"start game",LISTEN_READY_TO_START:"listen start game"}},3942:function(n,e,t){"use strict";t.d(e,{Z:function(){return u}});var r=t(5861),a=t(7757),i=t.n(a),o=t(2503),c=t(3486);function s(){return(s=(0,r.Z)(i().mark((function n(e){var t,r,a;return i().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,fetch("".concat(c.b.URL,"/channel/").concat(e),{method:"GET",headers:{"Content-Type":"application/json"}});case 3:return t=n.sent,n.next=6,t.json();case 6:return r=n.sent,a=r.data,n.abrupt("return",a);case 11:n.prev=11,n.t0=n.catch(0),alert(n.t0.message);case 14:case"end":return n.stop()}}),n,null,[[0,11]])})))).apply(this,arguments)}function u(n){var e=(0,o.ZP)(n?"/channel/".concat(n):null,(function(){return function(n){return s.apply(this,arguments)}(n)}));return{channel:e.data,error:e.error,mutate:e.mutate}}},1657:function(n,e,t){"use strict";t.d(e,{Z:function(){return a}});var r=t(3942);function a(n){var e=(0,r.Z)(n),t=e.channel,a=e.error,i=e.mutate;return{players:t?t.players:[],error:a,mutate:i}}},6388:function(n,e,t){"use strict";t.d(e,{cH:function(){return i},sV:function(){return o}});var r=t(7294),a=(0,t(8594).ZP)(),i=function(){return a.id};function o(n,e){return(0,r.useEffect)((function(){return a.on(n,e),function(){a.off(n,e)}}),[n,e]),a}},4708:function(n,e,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/channel/[channelId]",function(){return t(6065)}])},2361:function(){},4616:function(){}},function(n){n.O(0,[350,675,175,737,774,888,179],(function(){return e=4708,n(n.s=e);var e}));var e=n.O();_N_E=e}]);