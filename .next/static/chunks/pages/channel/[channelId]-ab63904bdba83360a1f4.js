(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[982],{3205:function(n,e,t){"use strict";t.r(e),t.d(e,{default:function(){return Dn}});var r=t(168),a=t(7294),i=t(4524),o=t(1163),c=t(3942),s=t(5785),u=t(5861),l=t(7757),d=t.n(l),p=(t(835),t(8853)),f=t.n(p),h=t(6388),m=t(7144),x=t(5893);function g(n){var e=n.peer,t=(0,a.useRef)();return(0,a.useEffect)((function(){e&&e.on("stream",(function(n){t.current.srcObject=n}))}),[e]),(0,x.jsx)("video",{ref:t,autoPlay:!0,width:"220px",height:"150px"})}var v,b,E=t(5675),y=t(1657),N=t(3486),j=t(3172);function w(n){var e=n.onShowResult,t=(0,o.useRouter)().query.channelId,r=(0,y.Z)(t),i=r.players,c=r.error,s=(0,a.useState)(""),l=s[0],p=s[1];if(c)return(0,x.jsx)(j.Z,{message:c.message});if(null==t||null==i)return null;function f(n){return h.apply(this,arguments)}function h(){return(h=(0,u.Z)(d().mark((function n(e){var r,a,i,o,c;return d().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.currentTarget,p(r.id),n.prev=2,n.next=5,fetch("".concat(N.b.URL,"/channel/").concat(t),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({state:"voting",playerId:r.id})});case 5:return a=n.sent,n.next=8,a.json();case 8:if(i=n.sent,o=i.result,c=i.message,"error"!==o){n.next=13;break}throw new Error(c);case 13:n.next=18;break;case 15:return n.prev=15,n.t0=n.catch(2),n.abrupt("return",(0,x.jsx)(j.Z,{message:n.t0.message}));case 18:case"end":return n.stop()}}),n,null,[[2,15]])})))).apply(this,arguments)}return(0,a.useEffect)((function(){var n=setTimeout((function(){e()}),6e3);return function(){return clearTimeout(n)}}),[]),(0,x.jsxs)(_,{children:[(0,x.jsx)("h1",{className:"vote-title",children:"\ucd5c\uace0\uc758 \uce90\ub9ad\ud130\uc5d0\uac8c \ud22c\ud45c\ud574\uc8fc\uc138\uc694"}),(0,x.jsx)("span",{className:"vote-subtitle",children:"\ud22c\ud45c\ub294 \ud55c \ubc88\ub9cc \ucc38\uc5ec \uac00\ub2a5\ud569\ub2c8\ub2e4."}),(0,x.jsx)("div",{className:"characters",children:i.map((function(n){var e,t,r;return(0,x.jsxs)(I,{className:"character",id:n._id,onClick:f,children:[(0,x.jsx)("div",{className:"img ".concat(l===n._id&&"border"),children:(0,x.jsx)(E.default,{src:null===(e=n.characterId)||void 0===e?void 0:e.imgUrl,alt:"character-image",width:150,height:200})}),(0,x.jsx)("span",{className:"character-name ".concat(l===n._id&&"color"),children:null===(t=n.characterId)||void 0===t?void 0:t.name}),(0,x.jsx)("span",{className:"user-name",children:null===(r=n.userId)||void 0===r?void 0:r.name})]},n._id)}))})]})}var S,T,_=i.Z.div(v||(v=(0,r.default)(["\n  width: 65%;\n  color: white;\n\n  .vote-title {\n    margin: 20px 0 0 0;\n    font-size: 2em;\n  }\n\n  .vote-subtitle {\n    padding: 20px 0 0 0;\n    font-weight: 200px;\n    font-size: 1.5em;\n    color: #898bf3;\n  }\n\n  .characters {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    margin-top: 40px;\n  }\n"]))),I=i.Z.div(b||(b=(0,r.default)(["\n  margin: 0 20px;\n  cursor: pointer;\n  transition: all 100ms ease-out;\n\n  &:hover {\n    transform: scale(1.02);\n  }\n\n  .img {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    margin-bottom: 20px;\n  }\n\n  .character-name {\n    display: block;\n    margin-bottom: 20px;\n    font-size: 1.4em;\n  }\n\n  .user-name {\n    background-color: #898bf3;\n    padding: 0px 10px;\n    border-radius: 5px;\n    font-weight: 700;\n    font-size: 1.2em;\n    color: black;\n  }\n\n  .color {\n    color: ",";\n  }\n\n  .border {\n    border: ",";\n  }\n"])),(function(n){return n.theme.pink}),(function(n){return"3px solid"+n.theme.pink}));function k(n,e){var t="undefined"!==typeof Symbol&&n[Symbol.iterator]||n["@@iterator"];if(!t){if(Array.isArray(n)||(t=function(n,e){if(!n)return;if("string"===typeof n)return Z(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);"Object"===t&&n.constructor&&(t=n.constructor.name);if("Map"===t||"Set"===t)return Array.from(n);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Z(n,e)}(n))||e&&n&&"number"===typeof n.length){t&&(n=t);var r=0,a=function(){};return{s:a,n:function(){return r>=n.length?{done:!0}:{done:!1,value:n[r++]}},e:function(n){throw n},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,c=!1;return{s:function(){t=t.call(n)},n:function(){var n=t.next();return o=n.done,n},e:function(n){c=!0,i=n},f:function(){try{o||null==t.return||t.return()}finally{if(c)throw i}}}}function Z(n,e){(null==e||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}function R(){var n=(0,o.useRouter)().query.channelId,e=(0,o.useRouter)(),t=(0,y.Z)(n),r=t.players,i=t.error,c=(0,a.useState)([]),l=c[0],p=c[1];if(i)return(0,x.jsx)(j.Z,{message:i.message});function f(){return(f=(0,u.Z)(d().mark((function e(){var t,r,a,i;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("".concat(N.b.URL,"/channel/").concat(n),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({state:"end",channelId:n})});case 3:return t=e.sent,e.next=6,t.json();case 6:if(r=e.sent,a=r.result,i=r.message,"error"!==a){e.next=11;break}throw new Error(i);case 11:e.next=16;break;case 13:return e.prev=13,e.t0=e.catch(0),e.abrupt("return",(0,x.jsx)(j.Z,{message:e.t0.message}));case 16:case"end":return e.stop()}}),e,null,[[0,13]])})))).apply(this,arguments)}return(0,a.useEffect)((function(){var t=setTimeout((function(){e.push("/main")}),6e3);return function(){clearTimeout(t),function(){f.apply(this,arguments)}(),h.UX.emit(m.EVENTS.END_CHANNEL,n),h.UX.off(m.EVENTS.LISTEN_ENTER_CHANNEL),h.UX.off(m.EVENTS.LISTEN_NEW_CHAT)}}),[]),(0,a.useEffect)((function(){var n=r.map((function(n){return n.voteCount}));r.forEach((function(e){e.voteCount===Math.max.apply(Math,(0,s.Z)(n))&&p((function(n){return n.concat(e._id)}))}))}),[]),(0,x.jsxs)(C,{children:[(0,x.jsx)("h1",{className:"result-title",children:"\ud22c\ud45c \uacb0\uacfc"}),(0,x.jsxs)("span",{className:"result-subtitle",children:[function(){var n,e=[],t=k(r);try{for(t.s();!(n=t.n()).done;){var a=n.value;l.includes(a._id)&&e.push(", ".concat(a.userId.name,"\ub2d8"))}}catch(i){t.e(i)}finally{t.f()}return e.join(" ").slice(2)}()," \ucd95\ud558\ud569\ub2c8\ub2e4!"]}),(0,x.jsx)("div",{className:"characters",children:l&&r.map((function(n){var e,t,r,a,i=(a=n._id,null===l||void 0===l?void 0:l.includes(a));return(0,x.jsxs)(U,{id:n._id,iswinner:i,children:[(0,x.jsx)("div",{className:"img",children:(0,x.jsx)(E.default,{src:null===(e=n.characterId)||void 0===e?void 0:e.imgUrl,alt:"character-image",width:150,height:200})}),(0,x.jsx)("span",{className:"character-name",children:null===(t=n.characterId)||void 0===t?void 0:t.name}),(0,x.jsx)("span",{className:"user-name",children:null===(r=n.userId)||void 0===r?void 0:r.name}),(0,x.jsxs)("span",{className:"voting-result",children:[n.voteCount," \ud45c"]})]},n._id)}))})]})}var O,L,A,C=i.Z.div(S||(S=(0,r.default)(["\n  width: 65%;\n  height: 100%;\n  background-color: black;\n\n  .result-title {\n    margin: 0;\n    padding: 30px 0 10px 0;\n    font-size: 2em;\n    color: white;\n  }\n\n  .result-subtitle {\n    padding: 30px 0 30px 0;\n    font-weight: 200px;\n    font-size: 1.5em;\n    color: ",";\n  }\n\n  .characters {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    margin-top: 10px;\n  }\n"])),(function(n){return n.theme.pink||"white"})),U=i.Z.div(T||(T=(0,r.default)(["\n  margin: 0 20px;\n  cursor: pointer;\n  transition: all 100ms ease-out;\n\n  &:hover {\n    transform: scale(1.02);\n  }\n\n  .img {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    width: 153px;\n    height: 203px;\n    border: ",";\n  }\n\n  .character-name {\n    display: block;\n    padding: 10px 0;\n    font-size: 18px;\n    color: ",";\n  }\n\n  .user-name {\n    background-color: #898bf3;\n    padding: 1px 4px;\n    border-radius: 5px;\n    font-weight: 700;\n    font-size: 18px;\n    color: ",";\n  }\n\n  .voting-result {\n    display: block;\n    padding: 30px 0;\n    font-size: 24px;\n    color: ",";\n  }\n\n  .clicked {\n    color: ",";\n  }\n"])),(function(n){var e=n.iswinner,t=n.theme;return e?"3px solid"+t.pink:"none"}),(function(n){var e=n.iswinner,t=n.theme;return e?t.pink:"white"}),(function(n){return n.iswinner?"white":"black"}),(function(n){var e=n.iswinner,t=n.theme;return e?t.pink:"white"}),(function(n){return n.theme.pink}));function P(){var n=(0,o.useRouter)().query.channelId,e=(0,a.useState)([]),t=e[0],r=e[1],i=(0,a.useRef)([]),c=(0,a.useRef)(),l=(0,a.useRef)(),p=(0,a.useState)(!1),v=p[0],b=p[1],E=(0,a.useState)(!1),y=E[0],N=E[1],j=(0,a.useState)(!0),S=j[0],T=j[1];function _(n,e,t){var r=new(f())({initiator:!0,trickle:!1,stream:t});return r.on("signal",function(){var t=(0,u.Z)(d().mark((function t(r){return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:h.UX.emit(m.EVENTS.SENDING_SIGNAL,{userToSignal:n,callerId:e,signal:r});case 1:case"end":return t.stop()}}),t)})));return function(n){return t.apply(this,arguments)}}()),r}function I(n,e,t){var r=new(f())({initiator:!1,trickle:!1,stream:t});return r.on("signal",(function(n){h.UX.emit(m.EVENTS.RETURNING_SIGNAL,{signal:n,callerId:e})})),r.signal(n),r}return(0,h.sV)(m.EVENTS.LISTEN_READY_TO_START,(function(e){n===e&&l.current.play()})),(0,h.sV)(m.EVENTS.RECEIVING_RETURNED_SIGNAL,(function(n){var e=n.id,t=n.signal;i.current.find((function(n){return n.peerID===e})).peer.signal(t)})),(0,a.useEffect)((function(){return(0,u.Z)(d().mark((function e(){var t,a,o,u,l,p,f;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.getUserMedia({video:!0,audio:!0});case 2:t=e.sent,c.current.srcObject=t,a=JSON.parse(sessionStorage.getItem("user")),o=a._id,u=a.name,l=a.email,p=a.photoUrl,f={_id:o,name:u,email:l,photoUrl:p,channelId:n},h.UX.emit(m.EVENTS.ENTER_CHANNEL,f),h.UX.on(m.EVENTS.ALL_USER,(function(n){var e=[];n.forEach((function(n){var r=_(n,(0,h.cH)(),t);i.current.push({peerID:n,peer:r}),e.push(r)})),r(e)})),h.UX.on(m.EVENTS.USER_JOINED,(function(n){var e=n.signal,a=n.callerId,o=I(e,a,t);i.current.push({peerID:a,peer:o}),r((function(n){return[].concat((0,s.Z)(n),[o])}))}));case 9:case"end":return e.stop()}}),e)})))(),function(){h.UX.removeAllListeners(m.EVENTS.ALL_USER),h.UX.removeAllListeners(m.EVENTS.USER_JOINED),h.UX.removeAllListeners(m.EVENTS.RECEIVING_RETURNED_SIGNAL),h.UX.emit(m.EVENTS.END_CHANNEL,n),i.current=[],r((function(n){return n.forEach((function(n){n.destroy()})),[]}))}}),[]),(0,x.jsxs)(V,{children:[S&&(0,x.jsx)(z,{ref:l,playsInline:!0,src:"https://awwdwd.s3.ap-northeast-2.amazonaws.com/sampleVideo.mp4",onEnded:function(){N(!0),T(!1)},muted:!0}),y&&(0,x.jsx)(w,{onShowResult:function(){N(!1),T(!1),b(!0)}}),v&&(0,x.jsx)(R,{}),(0,x.jsxs)(H,{children:[(0,x.jsx)("video",{playsInline:!0,autoPlay:!0,ref:c,width:"220px",height:"150px",muted:!0}),t.map((function(n,e){return(0,x.jsx)(g,{peer:n},e)}))]})]})}var D,V=i.Z.div(O||(O=(0,r.default)(["\n  display: flex;\n  align-items: center;\n  height: 62vh;\n  background-image: linear-gradient(\n      rgba(5, 3, 19, 0.801),\n      rgba(5, 3, 19, 0.87),\n      rgba(2, 0, 36, 0.747),\n      rgba(5, 3, 19, 0.87),\n      rgba(4, 0, 27, 0.801)\n    ),\n    url('/images/background.jpg');\n"]))),z=i.Z.video(L||(L=(0,r.default)(["\n  width: 65%;\n  height: 100%;\n  background-color: black;\n"]))),H=i.Z.div(A||(A=(0,r.default)(["\n  width: 35%;\n  height: 100%;\n"]))),X=t(4942);function G(n){var e=n.player,t=e.userId,r=e.characterId;return(0,x.jsxs)(J,{children:[(0,x.jsx)("div",{className:"player-name",children:null===t||void 0===t?void 0:t.name}),(0,x.jsx)("div",{className:"character-name",children:null===r||void 0===r?void 0:r.name})]},null===t||void 0===t?void 0:t._id)}var Y,J=i.Z.div(D||(D=(0,r.default)(["\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n  height: 30%;\n  margin-top: 10px;\n  text-align: center;\n\n  .character-name {\n    width: 80px;\n    border-radius: 10px;\n    background-color: ",";\n    color: ",";\n  }\n"])),(function(n){return n.theme.pink}),(function(n){return n.theme.white}));function M(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),t.push.apply(t,r)}return t}function q(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?M(Object(t),!0).forEach((function(e){(0,X.Z)(n,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):M(Object(t)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))}))}return n}function W(){var n=(0,o.useRouter)().query.channelId,e=(0,y.Z)(n),t=e.players,r=e.error,a=e.mutate;return(0,h.sV)(m.EVENTS.LISTEN_ENTER_CHANNEL,(function(n){var e={userId:n};a((function(n){return q(q({},n),{},{players:[].concat((0,s.Z)(n.players),[e])})}))})),(0,h.sV)(m.EVENTS.LISTEN_EXIT_CHANNEL,(function(n){var e=t.filter((function(e){return e.userId._id!==n.userId}));a((function(n){return q(q({},n),{},{newPlayers:e})}))})),(0,h.sV)(m.EVENTS.LISTEN_PLAYER_READY,(function(n){var e=t.map((function(e){return e.userId._id===n._id&&(e.characterId=n.userRole.characterId),e}));a((function(n){return q(q({},n),{},{readyPlayers:e})}))})),null==n||null==t?null:r?(0,x.jsx)(j.Z,{message:r.message}):(0,x.jsx)(K,{children:t.map((function(n){return(0,x.jsx)(G,{player:n},n._id)}))})}var F,Q,B,$,K=i.Z.div(Y||(Y=(0,r.default)(["\n  width: 15%;\n  height: 100%;\n  padding-bottom: 30px;\n  color: white;\n"]))),nn=t(9254),en=t(4651),tn=t(9536),rn=t(694);function an(n){var e,t=n.isModalOpen,r=n.closeModal,i=n.selectedCharacters,o=(0,a.useState)([]),s=o[0],l=o[1],p=(0,a.useState)(null),f=p[0],g=p[1],v=(0,a.useState)(null),b=v[0],y=v[1],w=(0,en.useRouter)().query.channelId,S=(0,c.Z)(w),T=S.channel,_=S.error;if(null==w||null==T)return null;if(_||b)return _?(0,x.jsx)(j.Z,{message:_.message}):(0,x.jsx)(j.Z,{message:b.message});function I(){return(I=(0,u.Z)(d().mark((function n(e){var t,a,i,o,c,u;return d().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e.preventDefault(),f){n.next=3;break}return n.abrupt("return",alert(tn.f.SELECTION_REQUIRED));case 3:return t=JSON.parse(sessionStorage.getItem("user")),a=t._id,n.prev=4,n.next=7,fetch("".concat(N.b.URL,"/channel/").concat(w),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({state:"character",userId:a,characterId:f})});case 7:return i=n.sent,n.next=10,i.json();case 10:if(o=n.sent,c=o.result,u=o.message,"error"!==c){n.next=15;break}throw new Error(u);case 15:h.UX.emit(m.EVENTS.PLAYER_READY,{userId:a,characterId:f,channelId:w,episode:s}),r(),n.next=22;break;case 19:n.prev=19,n.t0=n.catch(4),y(n.t0);case 22:case"end":return n.stop()}}),n,null,[[4,19]])})))).apply(this,arguments)}function k(n){var e=n.currentTarget.id;if(i.includes(e))return alert(tn.f.SELECTION_FAIL);g(e)}return(0,a.useEffect)((function(){(0,u.Z)(d().mark((function n(){var e,t,r,a,i;return d().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,fetch("".concat(N.b.URL,"/episode/").concat(T.episode._id),{method:"GET",headers:{"Content-Type":"application/json"}});case 3:return e=n.sent,n.next=6,e.json();case 6:if(t=n.sent,r=t.result,a=t.data,i=t.message,"error"!==r){n.next=12;break}throw new Error(i);case 12:l(a),n.next=18;break;case 15:n.prev=15,n.t0=n.catch(0),y(n.t0);case 18:case"end":return n.stop()}}),n,null,[[0,15]])})))()}),[t]),(0,x.jsxs)(cn,{children:[(0,x.jsxs)("div",{className:"header",children:[(0,x.jsx)("span",{className:"title",children:"\uc5ed\ud560\uace0\ub974\uae30"}),(0,x.jsx)("button",{className:"exit-button",type:"button",onClick:r,children:"\ub098\uac00\uae30"})]}),(0,x.jsxs)(sn,{onSubmit:function(n){return I.apply(this,arguments)},children:[(0,x.jsx)("span",{className:"description",children:"\uc5f0\uae30\ud560 \ubc30\uc5ed\uc744 \uc120\ud0dd\ud558\uc138\uc694"}),(0,x.jsx)("div",{className:"episode-title",children:s.title}),(0,x.jsx)(un,{children:(0,x.jsx)("ul",{className:"character-list",children:null===(e=s.characters)||void 0===e?void 0:e.map((function(n){return(0,x.jsxs)(ln,{id:n._id,onClick:k,children:[(0,x.jsx)("span",{className:"character-name",children:n.name}),(0,x.jsx)("div",{className:f===n._id?"select":null,children:(0,x.jsx)(E.default,{src:n.imgUrl,alt:"character-img",width:90,height:100,layout:"responsive"})})]},n._id)}))})}),(0,x.jsx)("div",{className:"button",children:(0,x.jsx)(rn.Z,{type:"submit",bgColor:nn.Z.blue,color:nn.Z.white,children:"\ubc30\uc5ed \uace0\ub974\uae30"})})]})]})}var on,cn=i.Z.div(F||(F=(0,r.default)(["\n  width: 100%;\n  height: 100%;\n  border: 1px solid white;\n  background-color: ","90;\n  color: ",";\n\n  .header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    height: 10%;\n    margin-top: 25px;\n    padding: 0 50px;\n\n    .title {\n      font-size: 24px;\n      line-height: 24px;\n      color: ",";\n    }\n\n    .exit-button {\n      padding: 5px 10px;\n      border-radius: 10px;\n      background-color: transparent;\n      border: 1px solid white;\n      color: ",";\n      cursor: pointer;\n    }\n\n    :hover {\n      opacity: 0.7;\n    }\n  }\n"])),(function(n){return n.theme.darkNavy}),(function(n){return n.theme.white}),(function(n){return n.theme.blue}),(function(n){return n.theme.white})),sn=i.Z.form(Q||(Q=(0,r.default)(["\n  display: flex;\n  flex-direction: column;\n  align-items: flex-start;\n  height: 90%;\n  padding: 30px 50px;\n  box-sizing: border-box;\n  text-align: left;\n\n  .channel-name {\n    display: block;\n  }\n\n  .button {\n    margin: 15px auto 0 auto;\n  }\n"]))),un=i.Z.div(B||(B=(0,r.default)(["\n  margin-top: 10px;\n\n  .description {\n    font-size: 16px;\n  }\n\n  .character-list {\n    display: grid;\n    grid-template-columns: repeat(3, minmax(100px, 170px));\n    padding: 0;\n  }\n\n  .select {\n    border: 2px solid ",";\n  }\n\n  .image {\n    margin-top: 10px;\n  }\n"])),nn.Z.pink),ln=i.Z.li($||($=(0,r.default)(["\n  display: flex;\n  flex-direction: column;\n  height: 150px;\n  margin: 0 15px 20px 0;\n  font-size: 12px;\n  list-style: none;\n  cursor: pointer;\n\n  .character-name {\n    margin-bottom: 5px;\n    font-size: 1.2em;\n  }\n"]))),dn=t(4461);function pn(){var n=(0,a.useState)(!1),e=n[0],t=n[1],r=(0,a.useState)(null),i=r[0],l=r[1],p=(0,a.useState)(!1),f=p[0],g=p[1],v=(0,a.useState)([]),b=v[0],E=v[1],y=(0,o.useRouter)().query.channelId,w=(0,o.useRouter)(),S=(0,c.Z)(y).channel;function T(){t(!1)}function _(){return(_=(0,u.Z)(d().mark((function n(){var e,t,r;return d().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,fetch("".concat(N.b.URL,"/channel/").concat(y),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({state:"exit",userId:i})});case 3:if(e=n.sent,t=e.result,r=e.message,"error"!==t){n.next=7;break}throw new Error(r);case 7:h.UX.emit(m.EVENTS.EXIT_CHANNEL,{channelId:y,userId:i}),w.push("/main"),n.next=14;break;case 11:return n.prev=11,n.t0=n.catch(0),n.abrupt("return",(0,x.jsx)(j.Z,{message:n.t0.message}));case 14:case"end":return n.stop()}}),n,null,[[0,11]])})))).apply(this,arguments)}function I(){return(I=(0,u.Z)(d().mark((function n(){var e,t,r,a;return d().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,fetch("".concat(N.b.URL,"/channel/").concat(y),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({state:"start",channelId:y})});case 3:return e=n.sent,n.next=6,e.json();case 6:if(t=n.sent,r=t.result,a=t.message,"error"!==r){n.next=11;break}throw new Error(a);case 11:h.UX.emit(m.EVENTS.READY_TO_START,y),n.next=17;break;case 14:return n.prev=14,n.t0=n.catch(0),n.abrupt("return",(0,x.jsx)(j.Z,{message:n.t0.message}));case 17:case"end":return n.stop()}}),n,null,[[0,14]])})))).apply(this,arguments)}return(0,a.useEffect)((function(){var n=JSON.parse(sessionStorage.getItem("user"))._id;l(n)}),[]),(0,h.sV)(m.EVENTS.LISTEN_PLAYER_READY,(function(n){var e=n.characterId;E((function(n){return[].concat((0,s.Z)(n),[e])}))})),(0,h.sV)(m.EVENTS.LISTEN_GAME_START,(function(n){n&&i===(null===S||void 0===S?void 0:S.host._id)&&g(!0)})),(0,x.jsxs)(mn,{children:[f?(0,x.jsx)(rn.Z,{onClick:function(){return I.apply(this,arguments)},bgColor:nn.Z.pink,fontsize:"18px",children:"Start"}):(0,x.jsx)(rn.Z,{onClick:function(){t(!0)},bgColor:nn.Z.pink,fontsize:"18px",children:"Ready"}),(0,x.jsx)(rn.Z,{onClick:function(){return _.apply(this,arguments)},bgColor:nn.Z.blue,fontsize:"18px",children:"\ub098\uac00\uae30"}),e&&(0,x.jsx)(dn.Z,{closeModal:T,children:(0,x.jsx)(an,{selectedCharacters:b,closeModal:T,isModalOpen:e})})]})}var fn,hn,mn=i.Z.div(on||(on=(0,r.default)(["\n  width: 20%;\n  padding: 20px 0;\n\n  button {\n    margin: 20px;\n  }\n\n  .ready {\n    color: navy;\n  }\n"]))),xn=t(2503);function gn(){return(gn=(0,u.Z)(d().mark((function n(e){var t,r,a,i,o;return d().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,fetch("".concat(N.b.URL,"/chat/").concat(e),{method:"GET",headers:{"Content-Type":"application/json"}});case 3:return t=n.sent,n.next=6,t.json();case 6:if(r=n.sent,a=r.result,i=r.data,o=r.message,"error"!==a){n.next=12;break}throw new Error(o);case 12:return n.abrupt("return",i);case 15:return n.prev=15,n.t0=n.catch(0),n.abrupt("return",n.t0);case 18:case"end":return n.stop()}}),n,null,[[0,15]])})))).apply(this,arguments)}function vn(n){var e=(0,xn.ZP)(n?"/chat/channelId":null,(function(){return function(n){return gn.apply(this,arguments)}(n)}));return{chatList:e.data,mutate:e.mutate}}function bn(){var n=(0,o.useRouter)().query.channelId,e=vn(n),t=e.chatList,r=e.error,i=e.mutate,c=(0,a.useRef)();return r?(0,x.jsx)(j.Z,{message:r.message}):((0,a.useEffect)((function(){null!=t&&(c.current.scrollTop=c.current.scrollHeight)}),[t]),(0,h.sV)(m.EVENTS.LISTEN_NEW_CHAT,(function(n){i([].concat((0,s.Z)(t),[n]))})),null==n||null==t?null:(0,x.jsx)(yn,{ref:c,children:(0,x.jsx)("ul",{className:"chat-list",children:t.map((function(n){return(0,x.jsxs)(Nn,{children:[(0,x.jsx)("span",{className:"author",children:n.author}),(0,x.jsx)("span",{children:n.chat})]},n._id)}))})}))}var En,yn=i.Z.div(fn||(fn=(0,r.default)(["\n  height: 85%;\n  padding: 10px 30px 0 30px;\n  box-sizing: border-box;\n  border-inline: 2px solid ",";\n  background-color: ","80;\n  overflow-y: auto;\n  color: white;\n\n  .chat-list {\n    padding: 10px 0 0 10px;\n    list-style: none;\n    text-align: left;\n  }\n\n  &::-webkit-scrollbar {\n    width: 13px;\n    background-color: ",";\n  }\n\n  &::-webkit-scrollbar-thumb {\n    border-radius: 30px;\n    background-color: ",";\n\n    &:hover {\n      background-color: ",";\n      border: none;\n    }\n  }\n"])),(function(n){return n.theme.darkNavy}),(function(n){return n.theme.darkNavy}),(function(n){return n.theme.darkNavy}),(function(n){return n.theme.blue}),(function(n){return n.theme.white})),Nn=i.Z.li(hn||(hn=(0,r.default)(["\n  margin-top: 5px;\n\n  .author {\n    margin-right: 10px;\n    padding: 0 5px;\n    border-radius: 5px;\n    font-size: 14px;\n    line-height: 14px;\n    background-color: #d6d6d6;\n    color: ",";\n  }\n"])),(function(n){return n.theme.darkNavy}));function jn(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),t.push.apply(t,r)}return t}function wn(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?jn(Object(t),!0).forEach((function(e){(0,X.Z)(n,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):jn(Object(t)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))}))}return n}function Sn(){var n=(0,o.useRouter)().query.channelId,e=(0,a.useState)({author:"",chat:""}),t=e[0],r=e[1],i=(0,a.useState)(""),c=i[0],s=i[1];function l(){return(l=(0,u.Z)(d().mark((function e(a){var i,o,s,u;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.preventDefault(),e.prev=1,e.next=4,fetch("".concat(N.b.URL,"/chat"),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({channelId:n,input:t})});case 4:return i=e.sent,e.next=7,i.json();case 7:if(o=e.sent,s=o.result,u=o.message,"error"!==s){e.next=12;break}throw new Error(u);case 12:e.next=17;break;case 14:return e.prev=14,e.t0=e.catch(1),e.abrupt("return",(0,x.jsx)(j.Z,{message:e.t0.message}));case 17:h.UX.emit(m.EVENTS.NEW_CHAT,{channelId:n,input:t}),r({author:null===c||void 0===c?void 0:c.replace(" ",""),chat:""});case 19:case"end":return e.stop()}}),e,null,[[1,14]])})))).apply(this,arguments)}return(0,a.useEffect)((function(){var n=JSON.parse(sessionStorage.getItem("user")).name;s(n),r(wn(wn({},t),{},{author:c.replace(" ","")}))}),[]),(0,x.jsxs)(_n,{onSubmit:function(n){return l.apply(this,arguments)},children:[(0,x.jsx)("input",{type:"text",value:t.chat,autoComplete:"off",onChange:function(n){var e=n.target.value.trim();""!==e&&r(wn(wn({},t),{},{chat:e}))}}),(0,x.jsx)("button",{type:"submit",children:"Enter"})]})}var Tn,_n=i.Z.form(En||(En=(0,r.default)(["\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  padding: 0 30px;\n  background-color: ",";\n\n  input {\n    width: 80%;\n    height: 40px;\n    padding: 0px 20px;\n    border: none;\n    font-size: 16px;\n\n    &:focus {\n      outline: none;\n    }\n  }\n\n  button {\n    display: inline-block;\n    width: 15%;\n    height: 30px;\n    outline: none;\n    border: none;\n    cursor: pointer;\n    border-radius: 15px;\n    background-color: ",";\n  }\n"])),(function(n){return n.theme.white}),(function(n){return n.theme.blue}));function In(){return(0,x.jsxs)(Zn,{children:[(0,x.jsx)(bn,{}),(0,x.jsx)(Sn,{})]})}var kn,Zn=i.Z.div(Tn||(Tn=(0,r.default)(["\n  width: 65%;\n  height: 100%;\n  background-size: cover;\n  background-image: linear-gradient(\n      rgba(5, 3, 19, 0.801),\n      rgba(5, 3, 19, 0.788),\n      rgba(5, 3, 19, 0.568),\n      rgba(5, 3, 19, 0.788),\n      rgba(5, 3, 19, 0.801)\n    ),\n    url('/images/11.jpg');\n"])));function Rn(){return(0,x.jsxs)(An,{children:[(0,x.jsx)(In,{}),(0,x.jsx)(W,{}),(0,x.jsx)(pn,{})]})}var On,Ln,An=i.Z.div(kn||(kn=(0,r.default)(["\n  display: flex;\n  width: 100%;\n  height: 30vh;\n  background-size: cover;\n"])));function Cn(){var n=(0,o.useRouter)().query.channelId,e=(0,c.Z)(n),t=e.channel,r=e.error;if(r)return(0,x.jsx)(j.Z,{message:r.message});if(null==n||null==t)return null;var a=t.name,i=t.episode;return(0,x.jsxs)(Un,{children:[(0,x.jsxs)(Pn,{children:[(0,x.jsx)("h2",{className:"channel-name",children:a}),(0,x.jsx)("h3",{className:"episode-title",children:null===i||void 0===i?void 0:i.title})]}),(0,x.jsx)(P,{}),(0,x.jsx)(Rn,{})]})}var Un=i.Z.div(On||(On=(0,r.default)(["\n  display: flex;\n  flex-direction: column;\n  text-align: center;\n  background-size: cover;\n  background-image: linear-gradient(\n      rgba(5, 3, 19, 0.801),\n      rgba(5, 3, 19, 0.788),\n      rgba(5, 3, 19, 0.568),\n      rgba(5, 3, 19, 0.788),\n      rgba(5, 3, 19, 0.801)\n    ),\n    url('/images/11.jpg');\n"]))),Pn=i.Z.div(Ln||(Ln=(0,r.default)(["\n  height: 8vh;\n  padding: 10px 20px;\n  text-align: left;\n  color: ",";\n  background-color: ",";\n  box-shadow: ",";\n\n  .channel-name {\n    margin: 0px;\n    font-size: 1em;\n    font-weight: 200;\n  }\n\n  .episode-title {\n    margin: 0px;\n    font-size: 1.1em;\n    font-weight: 500;\n  }\n"])),(function(n){return n.theme.white}),(function(n){return n.theme.darkNavy}),(function(n){return n.theme.whiteShadow}));function Dn(){return(0,x.jsx)(Cn,{})}},694:function(n,e,t){"use strict";t.d(e,{Z:function(){return p}});var r,a=t(168),i=t(4942),o=t(4925),c=(t(7294),t(4524)),s=t(5893),u=["children"];function l(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),t.push.apply(t,r)}return t}function d(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?l(Object(t),!0).forEach((function(e){(0,i.Z)(n,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))}))}return n}function p(n){var e=n.children,t=(0,o.Z)(n,u);return(0,s.jsx)(f,d(d({},t),{},{children:e}))}p.defaultProps={type:"button"};var f=c.Z.button(r||(r=(0,a.default)(["\n  all: unset;\n  width: ",";\n  height: ",";\n  padding: 15px 20px;\n  font-size: ",";\n  line-height: ",";\n  font-weight: ",";\n  text-align: center;\n  cursor: pointer;\n  border-radius: ",";\n  background-color: ",";\n  transition-property: scale, translateY;\n  transition: scale 300ms ease-in;\n  color: ",";\n\n  &:hover {\n    transform: scale(0.97);\n    opacity: 80%;\n    background-color: ",";\n    color: ",";\n  }\n"])),(function(n){return n.width||"130px"}),(function(n){return n.height||"20px"}),(function(n){return n.fontSize||"15px"}),(function(n){return n.fontSize||"14px"}),(function(n){return n.fontWeight||"500"}),(function(n){return n.borderRadius||"20px"}),(function(n){var e=n.bgColor,t=n.theme;return e||t.gray}),(function(n){var e=n.color,t=n.theme;return e||t.black}),(function(n){var e=n.hoverBgColor,t=n.theme;return e||t.white}),(function(n){var e=n.hoverColor,t=n.theme;return e||t.darkNavy}))},3172:function(n,e,t){"use strict";t.d(e,{Z:function(){return o}});t(7294);var r=t(1664),a=t(694),i=t(5893);function o(n){var e=n.message;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("p",{children:e}),(0,i.jsx)(r.default,{href:"/",passHref:!0,children:(0,i.jsx)("a",{children:(0,i.jsx)(a.Z,{color:"red",children:"\ud648\uc73c\ub85c \ub3cc\uc544\uac00\uae30"})})})]})}},4461:function(n,e,t){"use strict";t.d(e,{Z:function(){return u}});var r,a,i,o=t(168),c=t(4524),s=t(5893);function u(n){var e=n.children,t=n.closeModal;return(0,s.jsxs)(l,{children:[(0,s.jsx)(d,{onClick:t}),(0,s.jsx)(p,{children:e})]})}var l=c.Z.div(r||(r=(0,o.default)(["\n  width: 100%;\n  height: 100%;\n"]))),d=c.Z.div(a||(a=(0,o.default)(["\n  z-index: 99;\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n  background: ","85;\n"])),(function(n){return n.theme.darkNavy})),p=c.Z.div(i||(i=(0,o.default)(["\n  z-index: 999;\n  position: fixed;\n  top: 50%;\n  left: 50%;\n  width: 600px;\n  height: 450px;\n  text-align: center;\n  transform: translate(-50%, -50%);\n  box-shadow: ",";\n"])),(function(n){return n.theme.whiteShadow}))},9536:function(n){n.exports.f={SELECTION_FAIL:"\uc774\ubbf8 \uc120\ud0dd\ub41c \uc5ed\ud560\uc785\ub2c8\ub2e4.",SELECTION_REQUIRED:"\ubc30\uc5ed\uc744 \uc120\ud0dd\ud574\uc8fc\uc138\uc694."}},3486:function(n){n.exports.b={URL:"https://api.vlive.live"}},7144:function(n){n.exports.EVENTS={ENTER_CHANNEL:"enter channel",LISTEN_ENTER_CHANNEL:"listen enter channel",CREATE_CHANNEL:"create channel",LISTEN_CREATE_CHANNEL:"listen create channel",EXIT_CHANNEL:"exit channel",LISTEN_EXIT_CHANNEL:"listen exit channel",END_CHANNEL:"end channel",LISTEN_END_CHANNEL:"listen end channel",NEW_CHAT:"new chat",LISTEN_NEW_CHAT:"listen new chat",PLAYER_READY:"player ready",LISTEN_PLAYER_READY:"listen player ready",LISTEN_SEND_SIGNAL:"listen send signal",ALL_USER:"all user",SENDING_SIGNAL:"sending signal",RETURNING_SIGNAL:"returning signal",USER_JOINED:"user joined",RECEIVING_RETURNED_SIGNAL:"receiving returned signal",LISTEN_GAME_START:"listen game start",READY_TO_START:"start game",LISTEN_READY_TO_START:"listen start game"}},3942:function(n,e,t){"use strict";t.d(e,{Z:function(){return u}});var r=t(5861),a=t(7757),i=t.n(a),o=t(2503),c=t(3486);function s(){return(s=(0,r.Z)(i().mark((function n(e){var t,r,a;return i().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,fetch("".concat(c.b.URL,"/channel/").concat(e),{method:"GET",headers:{"Content-Type":"application/json"}});case 3:return t=n.sent,n.next=6,t.json();case 6:return r=n.sent,a=r.data,n.abrupt("return",a);case 11:n.prev=11,n.t0=n.catch(0),alert(n.t0.message);case 14:case"end":return n.stop()}}),n,null,[[0,11]])})))).apply(this,arguments)}function u(n){var e=(0,o.ZP)(n?"/channel/".concat(n):null,(function(){return function(n){return s.apply(this,arguments)}(n)}));return{channel:e.data,error:e.error,mutate:e.mutate}}},1657:function(n,e,t){"use strict";t.d(e,{Z:function(){return a}});var r=t(3942);function a(n){var e=(0,r.Z)(n),t=e.channel,a=e.error,i=e.mutate;return{players:t?t.players:[],error:a,mutate:i}}},6388:function(n,e,t){"use strict";t.d(e,{cH:function(){return i},sV:function(){return o},UX:function(){return c}});var r=t(7294),a=(0,t(8594).ZP)(),i=function(){return a.id};function o(n,e){return(0,r.useEffect)((function(){return a.on(n,e),function(){a.off(n,e)}}),[n,e]),a}var c=a},4708:function(n,e,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/channel/[channelId]",function(){return t(3205)}])},2361:function(){},4616:function(){}},function(n){n.O(0,[160,595,774,888,179],(function(){return e=4708,n(n.s=e);var e}));var e=n.O();_N_E=e}]);